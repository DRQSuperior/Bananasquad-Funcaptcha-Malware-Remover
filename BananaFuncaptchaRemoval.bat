@echo off

REM Check if running with administrative privileges
>nul 2>&1 net session && (
    REM If running with admin privileges, continue with the script
) || (
    REM If not running with admin privileges, relaunch as admin
    echo Requesting administrative privileges...
    powershell.exe -Command "Start-Process '%0' -Verb RunAs"
    exit /b
)

color 4
echo github.com/DRQSuperior

REM Remove unwanted files and directories
echo Deleting unwanted files and directories...
del /f /q "%APPDATA%\gruppe_storage" >nul 2>&1
del /f /q "%TEMP%\RuntimeBroker.exe" >nul 2>&1
del /f /q "%TEMP%\hakabonk.exe" >nul 2>&1
del /f /q "%APPDATA%\Microsoft\runpython.py" >nul 2>&1
del /f /q "%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\hvnc.py" >nul 2>&1
rmdir /s /q "C:\Windows\WinEmptyfold" >nul 2>&1
echo Unwanted files and directories removed.

REM Remove Windows Defender exclusions
echo Removing Windows Defender exclusions...
"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -Command "Remove-MpPreference -ExclusionExtension '.exe'"
"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -Command "Remove-MpPreference -ExclusionExtension '.dll'"
"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -Command "Remove-MpPreference -ExclusionPath 'C:\'"
echo Windows Defender exclusions removed.

REM Clean temporary files
echo Cleaning temporary files...
del /f /q "%TEMP%\*" >nul 2>&1
echo Temporary files cleaned.

REM Block malicious domains in hosts file
echo Blocking malicious domains in hosts file...
echo 0.0.0.0 bananasquad.ru >> "%SystemRoot%\System32\drivers\etc\hosts"
echo 0.0.0.0 funcaptcha.ru >> "%SystemRoot%\System32\drivers\etc\hosts"
echo Malicious domains blocked in hosts file.

echo.
echo Malware removal steps completed successfully.
pause
